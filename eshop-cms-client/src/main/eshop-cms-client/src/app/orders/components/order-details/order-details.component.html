<ng-container *ngIf="order">
  <h1>Order #{{order.id}} on {{order.orderDate  | formatDate}}</h1>
  <div class="row">
    <div class="col-8">
      <div class="form-row">
        <div class="col-3">
          <select *ngIf="orderStatuses" class="form-control"
            appOrderStatus [orderStatus]="order.status"
            [(ngModel)]="order.status"
            (change)="updateOrder()">
            <option *ngFor="let status of orderStatuses" [value]="status.value">
              {{status.name}}
            </option>
          </select>
        </div>
        <div class="col-3">
          <select *ngIf="paidStatuses" class="form-control"
            appBooleanBadge [badgeValue]="order.paid"
            [(ngModel)]="order.paid"
            (change)="updateOrder()">
            <option *ngFor="let status of paidStatuses" [value]="status.value">
              {{status.name}}
            </option>
          </select>
        </div>
        <div class="col-3">
          <select *ngIf="paymentMethods" class="form-control"
            [(ngModel)]="order.paymentMethodId"
            (change)="updateOrder()">
            <option *ngFor="let pm of paymentMethods" [value]="pm.id">
              {{pm.name}}
            </option>
          </select>
        </div>
        <div class="col-3">
          <button type="button" class="btn btn-primary">
            <span class="fa fa-print"></span>
            <span>{{'common.print' | translate}}</span>
          </button>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <table class="table table-sm table-striped table-hover">
            <thead class="thead-dark">
              <tr>
                <th>#</th>
                <th class="text-nowrap">{{'common.image' | translate}}</th>
                <th class="text-nowrap">{{'common.productItem' | translate}}</th>
                <th class="text-nowrap">{{'common.price' | translate}}</th>
                <th class="text-nowrap">{{'common.quantityShort' | translate}}</th>
                <th class="text-nowrap">{{'common.sum' | translate}}</th>
                <th class="text-nowrap">{{'common.action' | translate}}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of order.items; let i = index">
                <th class="align-middle">{{i + 1}}</th>
                <td>
                  <img class="product-image img-fluid img-thumbnail"
                    src="{{'/images/' + item.product.productArticleId + '/' + item.product.article + '/' + item.product.mainImage}}">
                </td>
                <td class="align-middle">
                  <span class="d-block">{{item.product.fullTitle}}</span>
                  <span class="d-block font-weight-bold small">{{'common.article' | translate}}: {{item.product.article}}</span>
                </td>
                <td class="align-middle text-right text-nowrap">
                  <input *ngIf="isItemEdited(item)" type="text" class="form-control"
                    [(ngModel)]="editedOrderItem.price"
                    mask="0*.00" [dropSpecialCharacters]="false"
                    (keyup)="onItemEdit()">
                  <span *ngIf="!isItemEdited(item)">{{item.price}}</span>
                </td>
                <td class="align-middle text-right text-nowrap">
                  <input *ngIf="isItemEdited(item)" type="text" class="form-control"
                    [(ngModel)]="editedOrderItem.quantity"
                    mask="0*" [dropSpecialCharacters]="false"
                    (keyup)="onItemEdit()">
                    <span *ngIf="!isItemEdited(item)">{{item.quantity}}</span>
                </td>
                <td class="align-middle text-right text-nowrap">
                  <span *ngIf="isItemEdited(item)">{{editedOrderItem.totalAmount}}</span>
                  <span *ngIf="!isItemEdited(item)">{{item.totalAmount}}</span>
                </td>
                <td class="align-middle text-center">
                  <div class="btn-group btn-group-justified">
                    <ng-container *ngIf="!isItemEdited(item)">
                      <button type="button" class="btn btn-danger"
                        [disabled]="!isItemEnabled(item)"
                        [class.disabled]="!isItemEnabled(item)"
                        title="{{'common.removeOrderItem' | translate}}"
                        (click)="showRemoveOrderItemConfirmation(item)">
                        <span class="fa fa-times"></span>
                      </button>
                      <button type="button" class="btn btn-warning"
                        [class.disabled]="!isItemEnabled(item)"
                        [disabled]="!isItemEnabled(item)"
                        title="{{'common.editOrderItem' | translate}}"
                        (click)="editItem(item)">
                        <span class="fa fa-pencil"></span>
                      </button>
                    </ng-container>
                    <ng-container *ngIf="isItemEdited(item)">
                      <button type="button" class="btn btn-secondary"
                        title="{{'common.cancel' | translate}}"
                        (click)="cancelOrderItemEditing()">
                        <span class="fa fa-times"></span>
                      </button>
                      <button type="button" class="btn btn-primary"
                        title="{{'common.save' | translate}}"
                        (click)="saveEditedOrderItem(item)">
                        <span class="fa fa-check"></span>
                        </button>
                    </ng-container>
                  </div>
                </td>
              </tr>
            </tbody>
            <tfoot class="thead-dark">
              <tr>
                <th colspan="2" class="align-middle text-nowrap">
                  {{'common.delivery' | translate}}
                </th>
                <th>
                  <select *ngIf="shippingMethods" class="form-control"
                    [(ngModel)]="selectedShippingMethod"
                    (change)="onShippingMethodChanged()">
                    <option *ngFor="let sm of shippingMethods" [ngValue]="sm">
                      {{sm.name}} - {{sm.cost}}
                    </option>
                  </select>
                </th>
                <th colspan="2"></th>
                <th class="align-middle text-right text-nowrap">{{selectedShippingMethod.cost}}</th>
                <th colspan="2"></th>
              </tr>
              <tr>
                <th colspan="5" class="align-middle text-right text-nowrap">{{'common.total' | translate}}: </th>
                <th class="align-middle text-right text-nowrap">{{order.totalAmount}}</th>
                <th colspan="2"></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="card" *ngIf="!editedOrder">
        <div class="card-header bg-dark text-white">
          <span>{{'common.deliveryInfo' | translate}}</span>
          <button type="button" class="btn btn-dark text-warning"
            title="{{'common.edit' | translate}}"
            (click)="editOrderDetails()">
            <span class="fa fa-pencil"></span>
          </button>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{order.fullName}}</h5>
          <p class="card-text">{{order.phone}}</p>
          <address>
            <span class="d-block font-weight-bold">{{'common.address' | translate}}</span>
            <span class="d-block">{{order.address}}</span>
          </address>
        </div>
      </div>

      <div class="card" *ngIf="editedOrder">
        <div class="card-header bg-dark text-white">
          <span>{{'common.deliveryInfo' | translate}}</span>
          <div class="btn-group btn-group-justified">
            <button type="button" class="btn btn-dark text-primary"
              title="{{'common.save' | translate}}"
              (click)="saveEditedOrderDetails()">
              <span class="fa fa-check"></span>
            </button>
            <button type="button" class="btn btn-dark text-danger"
              title="{{'common.cancel' | translate}}"
              (click)="cancelOrderEditing()">
              <span class="fa fa-times"></span>
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label for="fullName">{{'common.fullName' | translate}}</label>
            <input id="fullName" type="text" class="form-control" [(ngModel)]="editedOrder.fullName">
          </div>
          <div class="form-group">
            <label for="phone">{{'common.phone' | translate}}</label>
            <input id="phone" type="text" class="form-control" [(ngModel)]="editedOrder.phone">
          </div>
          <div class="form-group">
            <label for="address">{{'common.address' | translate}}</label>
            <textarea id="address" class="form-control" [(ngModel)]="editedOrder.address"></textarea>
          </div>
          <div class="row align-middle ">
            <div class="col-12">
                <label for="deliveryDate">{{'common.deliveryDate' | translate}}: {{'common.fromToDate' | translate}}</label>
            </div>
            <div class="col-6">
              <input type="text" class="form-control" readonly="true"
                [(ngModel)]="editedOrder.deliveryDateFrom"
                bsDatepicker
                [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD hh:mm:ss', containerClass: 'theme-default' }">
                <timepicker [showMeridian]="false" [(ngModel)]="editedOrder.deliveryDateFrom"></timepicker>
            </div>
            <div class="col-6">
              <input type="text" class="form-control" readonly="true"
                [(ngModel)]="editedOrder.deliveryDateTo"
                bsDatepicker
                [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD hh:mm:ss', containerClass: 'theme-default' }">
                <timepicker [showMeridian]="false" [(ngModel)]="editedOrder.deliveryDateTo"></timepicker>
            </div>
          </div>
          <div class="form-group">
            <label for="customerComment">{{'common.customerComment' | translate}}</label>
            <textarea id="customerComment" class="form-control" [(ngModel)]="editedOrder.customerComment"></textarea>
          </div>
          <div class="form-group">
            <label for="email">{{'common.email' | translate}}</label>
            <input id="email" type="text" class="form-control" [(ngModel)]="editedOrder.email">
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>
